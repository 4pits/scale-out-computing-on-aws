


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.6">
    
    
      
        <title>Import custom AMI to provision capacity faster</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4b9ffd7b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../assets/css/custom.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#step-1-locate-your-base-ami" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Scale-Out Computing on AWS Knowledge Base" class="md-header-nav__button md-logo" aria-label="Scale-Out Computing on AWS Knowledge Base">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Scale-Out Computing on AWS Knowledge Base
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Import custom AMI to provision capacity faster
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/awslabs/scale-out-computing-on-aws/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    awslabs/scale-out-computing-on-aws
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Scale-Out Computing on AWS Knowledge Base" class="md-nav__button md-logo" aria-label="Scale-Out Computing on AWS Knowledge Base">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Scale-Out Computing on AWS Knowledge Base
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/awslabs/scale-out-computing-on-aws/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    awslabs/scale-out-computing-on-aws
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="What is Scale-Out Computing on AWS ?" class="md-nav__link">
      What is Scale-Out Computing on AWS ?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../access-soca-cluster/" title="How to access Scale-Out Computing on AWS" class="md-nav__link">
      How to access Scale-Out Computing on AWS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../install-soca-cluster/" title="Install your Scale-Out Computing on AWS cluster" class="md-nav__link">
      Install your Scale-Out Computing on AWS cluster
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../job-configuration-generator/" title="Job Submission Generator" class="md-nav__link">
      Job Submission Generator
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      FAQ
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="FAQ" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        FAQ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../FAQ/knowledge-base-all-errors/" title="Knowledge Base - List all Errors" class="md-nav__link">
      Knowledge Base - List all Errors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Analytics
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Analytics" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Analytics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../analytics/build-kibana-dashboards/" title="Create your own analytics dashboard" class="md-nav__link">
      Create your own analytics dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../analytics/monitor-cluster-activity/" title="Monitor your cluster and job activity" class="md-nav__link">
      Monitor your cluster and job activity
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../analytics/prevent-overspend-hpc-cost-on-aws-soca/" title="Keep control of your HPC cost on AWS" class="md-nav__link">
      Keep control of your HPC cost on AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../analytics/review-hpc-costs/" title="Review your HPC costs" class="md-nav__link">
      Review your HPC costs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../analytics/set-up-budget-project/" title="Set up budget per project" class="md-nav__link">
      Set up budget per project
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Security
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Security" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/backup-restore-your-cluster/" title="Backup your entire cluster automatically" class="md-nav__link">
      Backup your entire cluster automatically
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/integrate-cognito-sso/" title="Enable Oauth2 authentication with Cognito" class="md-nav__link">
      Enable Oauth2 authentication with Cognito
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/manage-queue-acls/" title="Manage Access Lists at queue level" class="md-nav__link">
      Manage Access Lists at queue level
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/manage-queue-instance-types/" title="Retrict provisioning of specific instance type" class="md-nav__link">
      Retrict provisioning of specific instance type
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/manage-queue-restricted-parameters/" title="Prevent user to change specific parameters" class="md-nav__link">
      Prevent user to change specific parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../security/update-soca-dns-ssl-certificate/" title="Change your DNS name and SSL certificate" class="md-nav__link">
      Change your DNS name and SSL certificate
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Storage
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Storage" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Storage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/backend-storage-options/" title="Understand backend storage" class="md-nav__link">
      Understand backend storage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../storage/launch-job-with-fsx/" title="Launch a job with FSx for Lustre" class="md-nav__link">
      Launch a job with FSx for Lustre
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      Tutorials
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../create-your-own-queue/" title="Create your own queue" class="md-nav__link">
      Create your own queue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../integration-ec2-job-parameters/" title="Job customization for EC2" class="md-nav__link">
      Job customization for EC2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-licenses-flexlm/" title="Job with FlexLM licenses requirements" class="md-nav__link">
      Job with FlexLM licenses requirements
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../job-start-stop-email-notification/" title="Automatic emails when your job start/stop" class="md-nav__link">
      Automatic emails when your job start/stop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../launch-always-on-instances/" title="Launch AlwaysOn nodes" class="md-nav__link">
      Launch AlwaysOn nodes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../launch-your-first-job/" title="Launch your first job" class="md-nav__link">
      Launch your first job
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../manage-ldap-users/" title="Centralized user management" class="md-nav__link">
      Centralized user management
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Import custom AMI to provision capacity faster
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Import custom AMI to provision capacity faster" class="md-nav__link md-nav__link--active">
      Import custom AMI to provision capacity faster
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-locate-your-base-ami" class="md-nav__link">
    Step 1: Locate your base AMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-launch-a-temporary-ec2-instance" class="md-nav__link">
    Step 2: Launch a temporary EC2 instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-pre-configure-your-ami" class="md-nav__link">
    Step 3: Pre-configure your AMI
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Pre-configure your AMI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-pre-install-system-packages" class="md-nav__link">
    3.1 Pre-Install system packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-pre-install-the-scheduler" class="md-nav__link">
    3.2: Pre-Install the scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-optional-pre-install-gnome" class="md-nav__link">
    3.3: (Optional) Pre-Install Gnome
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-reboot-your-ec2-machine" class="md-nav__link">
    3.4: Reboot your EC2 machine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-make-sure-you-do-not-have-any-libvirt-of-firewalldiptables" class="md-nav__link">
    3.5: Make sure you do not have any libvirt of firewalld/iptables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-create-your-ami" class="md-nav__link">
    Step 4: Create your AMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-test-your-new-ami" class="md-nav__link">
    Step 5: Test your new AMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-update-default-ami-optional" class="md-nav__link">
    Step 6: Update default AMI (Optional)
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Update default AMI (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-job" class="md-nav__link">
    Single job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entire-queue" class="md-nav__link">
    Entire queue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entire-cluster" class="md-nav__link">
    Entire cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../troubleshoot-job-queue/" title="Debug why your jobs are not starting" class="md-nav__link">
      Debug why your jobs are not starting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Workshops
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Workshops" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Workshops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/" title="About" class="md-nav__link">
      About
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10-2" type="checkbox" id="nav-10-2">
    
    <label class="md-nav__link" for="nav-10-2">
      DVCon
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="DVCon" data-md-level="2">
      <label class="md-nav__title" for="nav-10-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        DVCon
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/" title="DVCon Workshop Overview" class="md-nav__link">
      DVCon Workshop Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10-2-3" type="checkbox" id="nav-10-2-3">
    
    <label class="md-nav__link" for="nav-10-2-3">
      Modules
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Modules" data-md-level="3">
      <label class="md-nav__title" for="nav-10-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/modules/01-deploy-env/" title="Lab 1: Deploy Environment" class="md-nav__link">
      Lab 1: Deploy Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/modules/02-web-login/" title="Lab 2: Login to SOCA Console and Launch Remote Desktop Session" class="md-nav__link">
      Lab 2: Login to SOCA Console and Launch Remote Desktop Session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/modules/03-login-compile/" title="Lab 3: Login to Remote Desktop and Compile Design" class="md-nav__link">
      Lab 3: Login to Remote Desktop and Compile Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/modules/04-submit-batch/" title="Lab 4: Submit Batch Jobs" class="md-nav__link">
      Lab 4: Submit Batch Jobs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/modules/05-load-verdi/" title="Lab 5: Bring up Verdi" class="md-nav__link">
      Lab 5: Bring up Verdi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/modules/06-analytics/" title="Lab 6: Explore Analytics Dashboard" class="md-nav__link">
      Lab 6: Explore Analytics Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/DVCon/modules/09-wrap-up/" title="Wrap-up" class="md-nav__link">
      Wrap-up
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10-3" type="checkbox" id="nav-10-3">
    
    <label class="md-nav__link" for="nav-10-3">
      TKO Scale Out Computing
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="TKO Scale Out Computing" data-md-level="2">
      <label class="md-nav__title" for="nav-10-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        TKO Scale Out Computing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/" title="Scaling EDA with Vivado Workshop Overview" class="md-nav__link">
      Scaling EDA with Vivado Workshop Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10-3-3" type="checkbox" id="nav-10-3-3">
    
    <label class="md-nav__link" for="nav-10-3-3">
      Modules
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Modules" data-md-level="3">
      <label class="md-nav__title" for="nav-10-3-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/02-deploy-env/" title="Lab 1: Deploy Environment" class="md-nav__link">
      Lab 1: Deploy Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/03-configure-desktop/" title="Lab 2: Configure Remote Desktop" class="md-nav__link">
      Lab 2: Configure Remote Desktop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/04-web-login/" title="Lab 3: Launch Remote Desktop Session" class="md-nav__link">
      Lab 3: Launch Remote Desktop Session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/06-launch-vivado/" title="Lab 4: Launch Vivado GUI" class="md-nav__link">
      Lab 4: Launch Vivado GUI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/07-submit-batch/" title="Lab 5: Submit Batch Workloads" class="md-nav__link">
      Lab 5: Submit Batch Workloads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/071-budgets/" title="Lab 6: Configure Budgets" class="md-nav__link">
      Lab 6: Configure Budgets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/08-analytics/" title="Lab 7: Explore Analytics Dashboard" class="md-nav__link">
      Lab 7: Explore Analytics Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/TKO-Scale-Out-Computing/modules/09-wrap-up/" title="Wrap-up" class="md-nav__link">
      Wrap-up
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10-4" type="checkbox" id="nav-10-4">
    
    <label class="md-nav__link" for="nav-10-4">
      reinvent19 MFG405
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="reinvent19 MFG405" data-md-level="2">
      <label class="md-nav__title" for="nav-10-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        reinvent19 MFG405
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/" title="MFG405 Workshop Overview" class="md-nav__link">
      MFG405 Workshop Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10-4-3" type="checkbox" id="nav-10-4-3">
    
    <label class="md-nav__link" for="nav-10-4-3">
      Modules
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Modules" data-md-level="3">
      <label class="md-nav__title" for="nav-10-4-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Modules
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/02-deploy-env/" title="Lab 1: Deploy Environment" class="md-nav__link">
      Lab 1: Deploy Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/03-configure-desktop/" title="Lab 2: Configure Remote Desktop" class="md-nav__link">
      Lab 2: Configure Remote Desktop
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/04-web-login/" title="Lab 3: Launch Remote Desktop Session" class="md-nav__link">
      Lab 3: Launch Remote Desktop Session
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/06-launch-vivado/" title="Lab 4: Launch Vivado GUI" class="md-nav__link">
      Lab 4: Launch Vivado GUI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/07-submit-batch/" title="Lab 5: Submit Batch Workloads" class="md-nav__link">
      Lab 5: Submit Batch Workloads
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/08-analytics/" title="Lab 6: Explore Analytics Dashboard" class="md-nav__link">
      Lab 6: Explore Analytics Dashboard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/09-wrap-up/" title="Wrap-up" class="md-nav__link">
      Wrap-up
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../workshops/reinvent19-MFG405/modules/z-budgets/" title="." class="md-nav__link">
      .
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-locate-your-base-ami" class="md-nav__link">
    Step 1: Locate your base AMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-launch-a-temporary-ec2-instance" class="md-nav__link">
    Step 2: Launch a temporary EC2 instance
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-pre-configure-your-ami" class="md-nav__link">
    Step 3: Pre-configure your AMI
  </a>
  
    <nav class="md-nav" aria-label="Step 3: Pre-configure your AMI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-pre-install-system-packages" class="md-nav__link">
    3.1 Pre-Install system packages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-pre-install-the-scheduler" class="md-nav__link">
    3.2: Pre-Install the scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-optional-pre-install-gnome" class="md-nav__link">
    3.3: (Optional) Pre-Install Gnome
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-reboot-your-ec2-machine" class="md-nav__link">
    3.4: Reboot your EC2 machine
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-make-sure-you-do-not-have-any-libvirt-of-firewalldiptables" class="md-nav__link">
    3.5: Make sure you do not have any libvirt of firewalld/iptables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-4-create-your-ami" class="md-nav__link">
    Step 4: Create your AMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-5-test-your-new-ami" class="md-nav__link">
    Step 5: Test your new AMI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-6-update-default-ami-optional" class="md-nav__link">
    Step 6: Update default AMI (Optional)
  </a>
  
    <nav class="md-nav" aria-label="Step 6: Update default AMI (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-job" class="md-nav__link">
    Single job
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entire-queue" class="md-nav__link">
    Entire queue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entire-cluster" class="md-nav__link">
    Entire cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/awslabs/scale-out-computing-on-aws/edit/master/docs/tutorials/reduce-compute-node-launch-time-with-custom-ami.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                  <h1>Import custom AMI to provision capacity faster</h1>
                
                <p>By default, SOCA provision a vanilla AMI and install all required packages in ~3 to 5 minutes. 
If this cold time is not acceptable for your workload, you can <a href="../tutorials/launch-always-on-instances/">launch AlwaysOn instance</a> or pre-bake your AMI with all required libraries.</p>
<h3 id="step-1-locate-your-base-ami">Step 1: Locate your base AMI<a class="headerlink" href="#step-1-locate-your-base-ami" title="Permanent link">&para;</a></h3>
<p>Run <code>cat /etc/environment | grep SOCA_INSTALL_AMI</code> on your scheduler host</p>
<div class="highlight"><pre><span></span><code>$ ssh -i &lt;key&gt; ec2-user@&lt;ip&gt;
Last login: Wed Oct  <span class="m">2</span> <span class="m">20</span>:06:47 <span class="m">2019</span> from &lt;ip&gt;

   _____  ____   ______ ___
  / ___/ / __ <span class="se">\ </span>/ ____//   <span class="p">|</span>
  <span class="se">\_</span>_ <span class="se">\ </span>/ / / // /    / /<span class="p">|</span> <span class="p">|</span>
 ___/ // /_/ // /___ / ___ <span class="p">|</span>
/____/ <span class="se">\_</span>___/ <span class="se">\_</span>___//_/  <span class="p">|</span>_<span class="p">|</span>
Cluster: soca-uiupdates
&gt; <span class="nb">source</span> /etc/environment to SOCA paths

<span class="o">[</span>ec2-user@ip-30-0-1-28 ~<span class="o">]</span>$ cat /etc/environment <span class="p">|</span> grep SOCA_INSTALL_AMI
<span class="hll"><span class="nb">export</span> <span class="nv">SOCA_INSTALL_AMI</span><span class="o">=</span>ami-082b5a644766e0e6f
</span><span class="o">[</span>ec2-user@ip-30-0-1-28 ~<span class="o">]</span>$
</code></pre></div>

<h3 id="step-2-launch-a-temporary-ec2-instance">Step 2: Launch a temporary EC2 instance<a class="headerlink" href="#step-2-launch-a-temporary-ec2-instance" title="Permanent link">&para;</a></h3>
<p>Launch a new EC2 instance using the <code>SOCA_INSTALL_AMI</code> image
<img alt="" src="../../imgs/use-efa-ami-1.png" /></p>
<h3 id="step-3-pre-configure-your-ami">Step 3: Pre-configure your AMI<a class="headerlink" href="#step-3-pre-configure-your-ami" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Important</p>
<p>Step 3 is only required if you want to reduce the time required for your compute node to boot. You can skip this section if you just want to install your customization on your AMI and let SOCA handles PBS/Gnome/System packages installation. </p>
</div>
<h4 id="31-pre-install-system-packages">3.1 Pre-Install system packages<a class="headerlink" href="#31-pre-install-system-packages" title="Permanent link">&para;</a></h4>
<p>You can pre-install the packages listed on <a href="https://github.com/awslabs/scale-out-computing-on-aws/blob/master/source/scripts/config.cfg">https://github.com/awslabs/scale-out-computing-on-aws/blob/master/source/scripts/config.cfg</a>. You will need to run <code>yum install</code> for:</p>
<ul>
<li>SYSTEM_PKGS</li>
<li>SCHEDULER_PKGS</li>
<li>OPENLDAP_SERVER_PKGS</li>
<li>SSSD_PKGS</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Easy Install</p>
<ul>
<li>Copy the content of the <code>config.cfg</code> on your filesystem (say <code>/root/config.cfg</code>)</li>
<li>Run <code>source /root/config.cfg</code></li>
<li>Run the following commands:<ul>
<li><code>yum install -y $(echo ${SYSTEM_PKGS[*]})</code></li>
<li><code>yum install -y $(echo ${SCHEDULER_PKGS[*]})</code></li>
<li><code>yum install -y $(echo ${OPENLDAP_SERVER_PKGS[*]})</code></li>
<li><code>yum install -y $(echo ${SSSD_PKGS[*]})</code></li>
</ul>
</li>
</ul>
<hr />
<p><a href="https://github.com/awslabs/scale-out-computing-on-aws/blob/master/source/scripts/Scheduler.sh#L34">Here is an example</a> of how you can install packages listed in an array in bash.</p>
</div>
<h4 id="32-pre-install-the-scheduler">3.2: Pre-Install the scheduler<a class="headerlink" href="#32-pre-install-the-scheduler" title="Permanent link">&para;</a></h4>
<p>To reduce the launch time of your EC2 instance, it's recommended to pre-install PBSPro. 
First, refer to <a href="https://github.com/awslabs/scale-out-computing-on-aws/blob/master/source/scripts/config.cfg">https://github.com/awslabs/scale-out-computing-on-aws/blob/master/source/scripts/config.cfg</a> and note all PBSPro related variables as you will need to use them below (see highlighted lines):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Sudo as Root</span>
sudo su -

<span class="c1"># Define PBSPro variable</span>
<span class="hll"><span class="nb">export</span> <span class="nv">PBSPRO_URL</span><span class="o">=</span>&lt;variable_from_config.txt&gt; <span class="c1"># ex https://github.com/PBSPro/pbspro/releases/download/v18.1.4/pbspro-18.1.4.tar.gz</span>
</span><span class="hll"><span class="nb">export</span> <span class="nv">PBSPRO_TGZ</span><span class="o">=</span>&lt;variable_from_config.txt&gt; <span class="c1"># ex pbspro-18.1.4.tar.gz</span>
</span><span class="hll"><span class="nb">export</span> <span class="nv">PBSPRO_VERSION</span><span class="o">=</span>&lt;variable_from_config.txt&gt; <span class="c1"># ex 18.1.4</span>
</span>
<span class="c1"># Run the following command to install PBS</span>
<span class="nb">cd</span> ~
wget <span class="nv">$PBSPRO_URL</span>
tar zxvf <span class="nv">$PBSPRO_TGZ</span>
<span class="nb">cd</span> pbspro-<span class="nv">$PBSPRO_VERSION</span>
./autogen.sh
./configure --prefix<span class="o">=</span>/opt/pbs
make -j6
make install -j6
/opt/pbs/libexec/pbs_postinstall
chmod <span class="m">4755</span> /opt/pbs/sbin/pbs_iff /opt/pbs/sbin/pbs_rcp
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Installation Path</p>
<p>Make sure to install pbspro under <code>/opt/pbs</code></p>
</div>
<h4 id="33-optional-pre-install-gnome">3.3: (Optional) Pre-Install Gnome<a class="headerlink" href="#33-optional-pre-install-gnome" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>If you are using <code>RHEL</code>, run <code>yum groupinstall "Server with GUI" -y</code></p>
</li>
<li>
<p>If you are using <code>Centos</code>, run <code>yum groupinstall "GNOME Desktop" -y</code></p>
</li>
<li>
<p>If you are using <code>Amazon Linux</code>, run <code>yum install -y $(echo ${DCV_AMAZONLINUX_PKGS[*]})</code></p>
</li>
</ul>
<h4 id="34-reboot-your-ec2-machine">3.4: Reboot your EC2 machine<a class="headerlink" href="#34-reboot-your-ec2-machine" title="Permanent link">&para;</a></h4>
<h4 id="35-make-sure-you-do-not-have-any-libvirt-of-firewalldiptables">3.5: Make sure you do not have any libvirt of firewalld/iptables<a class="headerlink" href="#35-make-sure-you-do-not-have-any-libvirt-of-firewalldiptables" title="Permanent link">&para;</a></h4>
<p>Post reboot, some distribution may automatically start libvirt or firewall. If that's the case you must delete them otherwise PBS won't be able to contact the master scheduler.
To find if you have a running libvirt, run <code>ifconfig</code> and check if you have <code>virbr0</code> interface such as:</p>
<div class="highlight"><pre><span></span><code>ifconfig
ens5: <span class="nv">flags</span><span class="o">=</span><span class="m">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="m">9001</span>
        inet <span class="m">10</span>.10.2.19  netmask <span class="m">255</span>.255.255.0  broadcast <span class="m">10</span>.10.2.255
        inet6 fe80::8b1:6aff:fe8a:5ad8  prefixlen <span class="m">64</span>  scopeid 0x20&lt;link&gt;
        ether 0a:b1:6a:8a:5a:d8  txqueuelen <span class="m">1000</span>  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets <span class="m">81</span>  bytes <span class="m">11842</span> <span class="o">(</span><span class="m">11</span>.5 KiB<span class="o">)</span>
        RX errors <span class="m">0</span>  dropped <span class="m">0</span>  overruns <span class="m">0</span>  frame <span class="m">0</span>
        TX packets <span class="m">92</span>  bytes <span class="m">12853</span> <span class="o">(</span><span class="m">12</span>.5 KiB<span class="o">)</span>
        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>

lo: <span class="nv">flags</span><span class="o">=</span><span class="m">73</span>&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class="m">65536</span>
        inet <span class="m">127</span>.0.0.1  netmask <span class="m">255</span>.0.0.0
        inet6 ::1  prefixlen <span class="m">128</span>  scopeid 0x10&lt;host&gt;
        loop  txqueuelen <span class="m">1000</span>  <span class="o">(</span>Local Loopback<span class="o">)</span>
        RX packets <span class="m">8</span>  bytes <span class="m">601</span> <span class="o">(</span><span class="m">601</span>.0 B<span class="o">)</span>
        RX errors <span class="m">0</span>  dropped <span class="m">0</span>  overruns <span class="m">0</span>  frame <span class="m">0</span>
        TX packets <span class="m">8</span>  bytes <span class="m">601</span> <span class="o">(</span><span class="m">601</span>.0 B<span class="o">)</span>
        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>

<span class="hll">virbr0: <span class="nv">flags</span><span class="o">=</span><span class="m">4099</span>&lt;UP,BROADCAST,MULTICAST&gt;  mtu <span class="m">1500</span>
</span><span class="hll">        inet <span class="m">192</span>.168.122.1  netmask <span class="m">255</span>.255.255.0  broadcast <span class="m">192</span>.168.122.255
</span><span class="hll">        ether <span class="m">52</span>:54:00:ea:5a:b9  txqueuelen <span class="m">1000</span>  <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class="hll">        RX packets <span class="m">0</span>  bytes <span class="m">0</span> <span class="o">(</span><span class="m">0</span>.0 B<span class="o">)</span>
</span><span class="hll">        RX errors <span class="m">0</span>  dropped <span class="m">0</span>  overruns <span class="m">0</span>  frame <span class="m">0</span>
</span><span class="hll">        TX packets <span class="m">0</span>  bytes <span class="m">0</span> <span class="o">(</span><span class="m">0</span>.0 B<span class="o">)</span>
</span><span class="hll">        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>
</span></code></pre></div>

<p>If that's the case, disable <code>libvirt</code> by running
<div class="highlight"><pre><span></span><code>/bin/systemctl disable libvirtd.service
ip link set virbr0 down
brctl delbr virbr0
</code></pre></div></p>
<p>Then, make sure you do not have iptables (<code>iptables -L</code>) running. If needed, disable <code>firewalld</code> by running <code>/bin/systemctl disable firewalld</code></p>
<h3 id="step-4-create-your-ami">Step 4: Create your AMI<a class="headerlink" href="#step-4-create-your-ami" title="Permanent link">&para;</a></h3>
<p>Once you are done, go back to EC2 console, locate your instance and click "Actions &gt; Image &gt; Create Image"
<img alt="" src="../../imgs/reduce-node-launch-time-1.png" /></p>
<p>Choose an AMI name and click 'Create Image'.
<img alt="" src="../../imgs/reduce-node-launch-time-2.png" /></p>
<p>Your AMI is now being created. Please note it may take a couple of minutes for the AMI to be ready. To check the status, go to EC2 Console and then click "AMIs" on the left sidebar
<img alt="" src="../../imgs/reduce-node-launch-time-3.png" /></p>
<div class="admonition warning">
<p class="admonition-title">Stop your temporary EC2 instance</p>
<p>Once your AMI has been created, you can safely terminate the EC2 instance you just launched as you won't need it anymore.</p>
</div>
<h3 id="step-5-test-your-new-ami">Step 5: Test your new AMI<a class="headerlink" href="#step-5-test-your-new-ami" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Test 1: Submit a job with a vanilla AMI</span>
<span class="hll">$ qsub -l <span class="nv">instance_type</span><span class="o">=</span>c5.9xlarge -- /bin/date 
</span>
<span class="c1"># Test 2: Submit a job with a pre-configured AMI</span>
<span class="hll">$ qsub -l <span class="nv">instance_type</span><span class="o">=</span>c5.9xlarge -l <span class="nv">instance_ami</span><span class="o">=</span>ami-0e05219e578020c64 -- /bin/date 
</span></code></pre></div>

<p><strong>Results:</strong></p>
<ul>
<li>Test1 (Vanilla): <strong>3 minutes 45 seconds</strong> to provision EC2 capacity, register node on SOCA and start the job</li>
<li>Test2 (Pre-Configured): <strong>1 minute 44 seconds</strong> to provision EC2 capacity, register host on SOCA and start the job</li>
</ul>
<h3 id="step-6-update-default-ami-optional">Step 6: Update default AMI (Optional)<a class="headerlink" href="#step-6-update-default-ami-optional" title="Permanent link">&para;</a></h3>
<h4 id="single-job">Single job<a class="headerlink" href="#single-job" title="Permanent link">&para;</a></h4>
<p>As you are planning to use a custom AMI, you will be required to specify <code>-l instance_ami=&lt;IMAGE_ID&gt;</code> at job submission.
It's recommended to go with the "Entire Queue" option below if you do not want to manually specify this resource each time you submit a job</p>
<h4 id="entire-queue">Entire queue<a class="headerlink" href="#entire-queue" title="Permanent link">&para;</a></h4>
<p>Edit <code>/apps/soca/&lt;CLUSTER_ID&gt;/cluster_manager/settings/queue_mapping.yml</code> and update the default AMI</p>
<div class="highlight"><pre><span></span><code><span class="nt">queue_type</span><span class="p">:</span>
  <span class="nt">compute</span><span class="p">:</span>
    <span class="nt">queues</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;queue1&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;queue2&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;queue3&quot;</span><span class="p p-Indicator">]</span> 
<span class="hll">    <span class="nt">instance_ami</span><span class="p">:</span> <span class="s">&quot;&lt;YOUR_AMI_ID&gt;&quot;</span> <span class="c1"># &lt;- Add your new AMI </span>
</span>    <span class="nt">instance_type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">...</span>
</code></pre></div>

<p>Any jobs running in the queue configured on the <code>queue_mapping</code> will now use your pre-configured AMI by default. You do not need to specify <code>-l instance_ami</code> at job submission anymore.</p>
<h4 id="entire-cluster">Entire cluster<a class="headerlink" href="#entire-cluster" title="Permanent link">&para;</a></h4>
<p>If you want to change the default AMI to use regardless of queue/job, open your Secret Manager console and select your Scale-Out Computing on AWS cluster configuration. Click “Retrieve Secret Value” and then “Edit”.
Find the entry “CustomAMI” and update the value with your new AMI ID then click Save</p>
<p><img alt="" src="../../imgs/reduce-node-launch-time-4.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../manage-ldap-users/" title="Centralized user management" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Centralized user management
              </div>
            </div>
          </a>
        
        
          <a href="../troubleshoot-job-queue/" title="Debug why your jobs are not starting" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Debug why your jobs are not starting
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.a0c4167b.min.js"></script>
      <script src="../../assets/javascripts/bundle.fb26dd1d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>